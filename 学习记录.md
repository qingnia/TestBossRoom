# 适配
1. 项目引用了navMesh库，2022版本已经内置到引擎，因此升级后要删掉库引用
2. auth库的2.4.0有bug，编辑器环境下profile检查会抛异常，导致编辑器环境不能使用lobby，仿照官方，降到2.3.1版本
# 参考文档
[知乎其他人经验 这个人的代码老旧，部分已经对不上](https://zhuanlan.zhihu.com/p/426092367)
# 语法
## inject
> 一知半解：网上看到的描述说这是种注入，实际使用效果更接近跨类共享数据

[Inject注入介绍](https://blog.csdn.net/qq_35531227/article/details/84839483)
## VContainer
> 看不懂
[VContainer](https://vcontainer.hadashikick.jp/resolving/gameobject-injection)
## readonly
> 声明后，可以在构造函数做一次赋值，之后就不能改变
## event
```c#的事件处理
//定义事件
        /// <summary>
        /// Server notification when a client requests a different lobby-seat, or locks in their seat choice
        /// </summary>
        public event Action<ulong, int, bool> OnClientChangedSeat;
//注册事件
        public void OnNetworkSpawn()
        {
            if (!NetworkManager.Singleton.IsServer)
            {
                enabled = false;
            }
            else
            {
                NetworkManager.Singleton.OnClientDisconnectCallback += OnClientDisconnectCallback;
                networkCharSelection.OnClientChangedSeat += OnClientChangedSeat;

                NetworkManager.Singleton.SceneManager.OnSceneEvent += OnSceneEvent;
            }
        }
        public void OnNetworkDespawn()
        {
            if (NetworkManager.Singleton)
            {
                NetworkManager.Singleton.OnClientDisconnectCallback -= OnClientDisconnectCallback;
                NetworkManager.Singleton.SceneManager.OnSceneEvent -= OnSceneEvent;
            }
            if (networkCharSelection)
            {
                networkCharSelection.OnClientChangedSeat -= OnClientChangedSeat;
            }
        }
//触发事件
        /// <summary>
        /// RPC to notify the server that a client has chosen a seat.
        /// </summary>
        [ServerRpc(RequireOwnership = false)]
        public void ChangeSeatServerRpc(ulong clientId, int seatIdx, bool lockedIn)
        {
            OnClientChangedSeat?.Invoke(clientId, seatIdx, lockedIn);
        }
```
# 设计
## startup
```c#
// 初始化都在NetworkManager.cs，声明并且注入了游戏状态机，游戏状态改变时调
```
## BossRoom
```c#
// OnLoadEventCompleted 这个事件会生成玩家
```
# rpc
##
```c#
//分主机和客机，serverRpc默认只有主机能调用
//如果声明了RequireOwnership=false，客机也能用，如角色选择
        /// <summary>
        /// RPC to notify the server that a client has chosen a seat.
        /// </summary>
        [ServerRpc(RequireOwnership = false)]
        public void ChangeSeatServerRpc(ulong clientId, int seatIdx, bool lockedIn)
        {
            OnClientChangedSeat?.Invoke(clientId, seatIdx, lockedIn);
        }
```